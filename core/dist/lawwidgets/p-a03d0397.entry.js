/*!
 * (C) Law Widgets https://laws.africa - GNU Lesser General Public License 3
 */
import{r as t,c as s,g as i}from"./p-201891dc.js";import{d as e}from"./p-721c7be8.js";import{g as o}from"./p-2d0d161b.js";class r{constructor(t){this.root=t;this.buffer=10;this.tops=new WeakMap;this.anchors=new WeakMap}layout(t){this.updateAnchorsAndItems(t);this.updateTops(t);t=this.sortItems(t);const s=t.find((t=>t.active));if(s){const i=t.indexOf(s);if(i>-1){const e=this.anchors.get(s);if(e){const o=this.tops.get(e);if(o){s.style.top=`${o}px`;this.layoutUpwards(t,i-1,o-this.buffer);this.layoutDownwards(t,i+1,o+s.clientHeight+this.buffer);return}}}}this.layoutDownwards(t,0,0)}sortItems(t){return[...t].sort(this.compareItems.bind(this))}compareItems(t,s){const i=this.anchors.get(t);const e=this.anchors.get(s);if(i){if(e){const t=this.tops.get(i);const s=this.tops.get(e);if(t){if(s){return t-s}else{return 1}}else{return-1}}else{return 1}}else{return-1}}layoutUpwards(t,s,i){for(let e=s;e>=0;e--){const s=t[e];const o=this.anchors.get(s);if(o){let t=this.tops.get(o);if(t){if(t+s.clientHeight>=i){t=i-s.clientHeight}s.style.top=`${t}px`;i=t-this.buffer}}}}layoutDownwards(t,s,i){for(let e=s;e<t.length;e++){const s=t[e];const o=this.anchors.get(s);if(o){let t=this.tops.get(o);if(t){t=Math.max(i,t);s.style.top=`${t}px`;i=t+s.clientHeight+this.buffer}}}}updateAnchorsAndItems(t){this.anchors=new WeakMap;for(const s of t){const t=this.getItemAnchor(s);if(t){this.anchors.set(s,t)}s.style.display=t?"":"none"}}getItemAnchor(t){if(t.anchor){if(t.anchor instanceof HTMLElement){return this.root.contains(t.anchor)?t.anchor:null}else{return this.root.querySelector(t.anchor)}}return null}updateTops(t){this.tops=new WeakMap;for(const s of t){const t=this.anchors.get(s);if(t&&!this.tops.has(t)){this.tops.set(t,this.calculateTop(t))}}}calculateTop(t){let s=0;let i=t;while(i&&i!==this.root){s+=i.offsetTop;i=i.offsetParent}return s}}const n=".la-akoma-ntoso-with-gutter{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row}.la-akoma-ntoso-with-gutter>la-akoma-ntoso{-ms-flex:80%;flex:80%;max-width:80%;position:relative;padding-right:0.5rem}.la-akoma-ntoso-with-gutter>la-gutter{-ms-flex:20%;flex:20%;max-width:20%;position:relative;overflow-y:hidden;background-color:rgba(0, 0, 0, 0.05);padding-left:0.5rem;padding-right:0.5rem}la-gutter>la-gutter-item{position:absolute;left:1rem;width:calc(100% - 1.5rem);-webkit-transition:top ease-out 100ms, left ease-out 100ms;transition:top ease-out 100ms, left ease-out 100ms;z-index:2}la-gutter>la-gutter-item[active]{left:0.5rem;z-index:3}";const h=n;const a=class{constructor(i){t(this,i);this.layoutComplete=s(this,"layoutComplete",7);this.debounceDelay=100;this.akomaNtoso=undefined}componentWillLoad(){this.akomaNtosoElement=o(this.el,this.akomaNtoso);this.queueLayout=e(this.layoutItems.bind(this),this.debounceDelay);this.mutationObserver=new MutationObserver(this.queueLayout);this.mutationObserver.observe(this.el,{childList:true})}componentDidLoad(){this.setupLayout();this.layoutItems()}disconnectedCallback(){if(this.mutationObserver){this.mutationObserver.disconnect()}if(this.resizeObserver){this.resizeObserver.disconnect()}}itemChanged(t){const s=t.target;if(s===null||s===void 0?void 0:s.active){this.setOtherItemsInactive(s)}this.queueLayout()}clicked(t){const s=t.target;if(s&&!s.closest("la-gutter-item")){Array.from(this.items()).forEach((t=>{t.active=false}))}}setOtherItemsInactive(t){Array.from(this.items()).forEach((s=>{if(s!=t){s.active=false}}))}setupLayout(){if(this.akomaNtosoElement){this.layout=new r(this.akomaNtosoElement);if(window.ResizeObserver){if(this.resizeObserver)this.resizeObserver.disconnect();this.resizeObserver=new ResizeObserver(this.queueLayout);this.resizeObserver.observe(this.akomaNtosoElement)}}}async layoutItems(){if(this.layout){this.layout.layout([...this.items()]);this.layoutComplete.emit()}}async activateNextItem(){const t=this.layout?this.layout.sortItems(this.getVisibleItems()):[];if(t.length===1){t[0].active=true;return t[0]}else if(t.length>1){const s=t.findIndex((t=>t.active));const i=s===-1||s===t.length-1?t[0]:t[s+1];i.active=true;return i}else{return null}}async activatePrevItem(){const t=this.layout?this.layout.sortItems(this.getVisibleItems()):[];if(t.length===1){t[0].active=true;return t[0]}else if(t.length>1){const s=t.findIndex((t=>t.active));const i=s===-1||s===0?t[t.length-1]:t[s-1];i.active=true;return i}else{return null}}items(){return this.el.querySelectorAll("la-gutter-item")}getVisibleItems(){return[...this.items()].filter((t=>t.style.display!=="none"))}get el(){return i(this)}};a.style=h;export{a as la_gutter};
//# sourceMappingURL=p-a03d0397.entry.js.map