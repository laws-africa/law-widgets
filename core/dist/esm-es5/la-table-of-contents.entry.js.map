{"version":3,"names":["TableOfContents","this","expandIconHtml","collapseIconHtml","PROVIDER","class_1","prototype","parseItemsProp","newValue","innerItems","JSON","parse","Array","isArray","__spreadArray","refetch","fetchContent","ensurePartner","fetch","frbrExpressionUri","provider","url","partner","resp","_c","sent","ok","_b","json","toc","getPartner","getSlotHTML","selector","element","el","querySelector","_a","innerHTML","componentWillLoad","items","titleFilterChanged","titleFilter","expandAll","from","querySelectorAll","forEach","item","expanded","collapseAll","filter","needle_1","toLocaleLowerCase","trim","filteredItems_1","Set","includeKids","_i","children","length","child","add","shouldInclude","include","title","includes","filteredItems","renderItem","_this","kids","map","undefined","h","render","Host","key","style","display","name"],"sources":["src/components/table-of-contents/table-of-contents.tsx"],"sourcesContent":["// eslint-disable-next-line no-unused-vars\nimport { Prop, h, Element, Method, Watch, State, Component, Host } from '@stencil/core';\n\nimport { PROVIDER, getPartner } from '../../utils/services';\n\n/**\n * An item in the table of contents. Each item must have a `title` attribute (which may be `null`),\n * and a `children` attribute (which may be `null`).\n */\nexport interface TOCItem {\n  title?: string;\n  id?: string;\n  href?: string;\n  expanded?: boolean;\n  children?: TOCItem[];\n}\n\n@Component({\n  tag: 'la-table-of-contents',\n})\nexport class TableOfContents {\n  /**\n   * JSON value or string value parsed to array of items used to build the table of contents. Each item must have\n   * a `title` attribute (which may be `null`), and a `children` attribute (which may be `null`).\n   *\n   * Items may optionally have an id attribute and an href attribute, which are used to build the links for each item.\n   * */\n  @Prop() items: TOCItem[] | string = [];\n\n  /**\n   * value to filter items by item title\n   * */\n  @Prop() titleFilter = '';\n\n  /**\n   * Should items be expanded by default? This can be overridden by setting the expanded property for individual items.\n   * */\n  @Prop() expanded = true;\n\n  /** Full Akoma Ntoso FRBR Expression URI to fetch TOC information for. Only used if `fetch` is set. */\n  @Prop({ reflect: true, mutable: true }) frbrExpressionUri?: string;\n  /** Fetch content from Laws.Africa services? Requires a Laws.Africa partnership and the frbrExpressionUri property to be set. */\n  @Prop({ reflect: true, mutable: true }) fetch = false;\n  /** Partner code to use when fetching content from Laws.Africa. Defaults to the `location.hostname`. */\n  @Prop({ reflect: true, mutable: true }) partner?: string;\n  /** Provider URL for fetching content (advanced usage only). */\n  @Prop() provider = PROVIDER;\n\n  @State() filteredItems: Set<TOCItem> | null = null;\n\n  @State() innerItems: TOCItem[] = [];\n\n  @Element() el!: HTMLElement;\n\n  protected expandIconHtml = '';\n  protected collapseIconHtml = '';\n\n  @Watch('items')\n  parseItemsProp(newValue: any) {\n    if (typeof newValue === 'string') {\n      this.innerItems = JSON.parse(newValue);\n    } else if (Array.isArray(newValue)) {\n      this.innerItems = [...newValue];\n    }\n  }\n\n  @Watch('provider')\n  @Watch('frbrExpressionUri')\n  @Watch('fetch')\n  refetch() {\n    this.fetchContent();\n  }\n\n  async fetchContent() {\n    this.ensurePartner();\n\n    if (this.fetch && this.frbrExpressionUri && this.provider) {\n      const url = this.provider + '/p/' + this.partner + '/e/we/toc.json' + this.frbrExpressionUri;\n      try {\n        const resp = await fetch(url);\n        if (resp.ok) {\n          // @ts-ignore\n          this.innerItems = (await resp.json()).toc;\n        }\n      } catch (error) {\n        // ignore\n      }\n    }\n  }\n\n  ensurePartner() {\n    if (!this.partner) {\n      this.partner = getPartner();\n    }\n  }\n\n  getSlotHTML(selector: string) {\n    const element = this.el.querySelector(selector);\n    /**\n     * If slots originate from `la-table-of-contents`, query for slot html is\n     * `this.el.querySelector(\"[slot]\").innerHTML`\n     * If slot originate from `la-table-of-contents-controller` query for slot html is\n     * `this.el.querySelector(\"[slot] [slot]\").innerHTML`\n     * */\n\n    // Slots originating from la-table-of-content-controller\n    if (element?.querySelector(selector)) {\n      return element.querySelector(selector)?.innerHTML || '';\n    }\n\n    // Slots originating from la-table-of-content\n    return element?.innerHTML || '';\n  }\n\n  componentWillLoad() {\n    this.expandIconHtml = this.getSlotHTML(\"[slot='expand-icon']\");\n    this.collapseIconHtml = this.getSlotHTML(\"[slot='collapse-icon']\");\n    this.parseItemsProp(this.items);\n    this.titleFilterChanged(this.titleFilter);\n    this.fetchContent();\n  }\n\n  /**\n   * Expands all items\n   */\n  @Method()\n  async expandAll() {\n    Array.from(this.el.querySelectorAll('la-toc-item')).forEach((item) => {\n      // @ts-ignore\n      item.expanded = true;\n    });\n  }\n\n  /**\n   * Collapses all items\n   */\n  @Method()\n  async collapseAll() {\n    Array.from(this.el.querySelectorAll('la-toc-item')).forEach((item) => {\n      // @ts-ignore\n      item.expanded = false;\n    });\n  }\n\n  @Watch('titleFilter')\n  titleFilterChanged(filter: string) {\n    if (filter) {\n      const needle = filter.toLocaleLowerCase().trim();\n      const filteredItems: Set<TOCItem> = new Set<TOCItem>();\n\n      // recursively include all children\n      // eslint-disable-next-line no-inner-declarations\n      function includeKids(item: TOCItem) {\n        for (const child of item.children || []) {\n          filteredItems.add(child);\n          includeKids(child);\n        }\n      }\n\n      // Recursive function that determines whether or not an item should be rendered.\n      // An item is rendered if its title matches the filter, or any of its children should be rendered.\n      // eslint-disable-next-line no-inner-declarations\n      function shouldInclude(item: TOCItem): boolean {\n        // this will be true if this item matches the search, or any child does\n        let include: boolean = (item.title?.toLocaleLowerCase() || '').includes(needle);\n\n        if (include) {\n          // this item matches, show include all children automatically, no need to go any deeper\n          includeKids(item);\n        } else {\n          // if any children match, then this node must be included\n          if (item.children) {\n            for (const child of item.children) {\n              include = shouldInclude(child) || include;\n            }\n          }\n        }\n\n        if (include) {\n          filteredItems.add(item);\n        }\n\n        return include;\n      }\n\n      for (const item of this.innerItems) {\n        shouldInclude(item);\n      }\n\n      this.filteredItems = filteredItems;\n    } else {\n      this.filteredItems = null;\n    }\n    this.expandAll();\n  }\n\n  /**\n   * Render items recursively. We render from the bottom up, allowing us to append children into their\n   * parents. Rendering recursively here rather than inside la-toc-item means we can make use of global\n   * configuration details without having to pass them down the tree.\n   */\n  renderItem(item: TOCItem) {\n    // render the children first, so we can add them to the parent\n    const kids = (item.children || []).map((child) => this.renderItem(child));\n    // if the item has an explicit expanded value, use that, otherwise use the tree's default value\n    const expanded = item.expanded === undefined ? this.expanded : item.expanded;\n\n    return <la-toc-item\n      item={item}\n      filteredItems={this.filteredItems}\n      expandIconHtml={this.expandIconHtml}\n      collapseIconHtml={this.collapseIconHtml}\n      expanded={expanded}\n    >{kids}</la-toc-item>;\n  }\n\n  render() {\n    return (\n      <Host>\n        <div style={{ display: 'none' }}>\n          <slot name=\"expand-icon\"></slot>\n          <slot name=\"collapse-icon\"></slot>\n        </div>\n        {this.innerItems.map((item) => this.renderItem(item))}\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}